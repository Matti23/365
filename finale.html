<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sorpresa!</title>
<link rel="shortcut icon" href="./images/cuore.png" type="image/x-icon">
<style>
body {
  margin: 0;
  font-family: 'Playfair Display', serif;
  background: linear-gradient(135deg, #ff9a9e, #fad0c4, #fbc2eb, #a6c1ee);
  background-size: 400% 400%;
  animation: gradientBG 15s ease infinite;
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  height: 100vh;
  text-align: center;
  position: relative;
}

h1 {
  font-size: 10vw;
  line-height: 1.2em;
  background: url('images/barcellona.jpg') no-repeat center/cover;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  position: relative;
  margin: 0;
  z-index: 2;
  opacity: 0;
  transform: scale(0.5);
  animation: textAppear 1s forwards;
  animation-delay: 1s;
}

h2 {
  font-size: clamp(18px, 3vw, 36px);
  color: #fff;
  text-shadow: 0 0 15px rgba(0,0,0,0.7);
  margin-top: 20px;
  opacity: 0;
  transform: translateY(20px);
  animation: subtitleAppear 1s forwards;
  animation-delay: 2s;
  z-index: 3;
}

@keyframes textAppear {
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes subtitleAppear {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

canvas {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 1;
}

@keyframes gradientBG {
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}
</style>
</head>
<body>

<!-- Audio -->
<audio id="audio" src="./images/Fermata_Canzone.mp3" loop></audio>

<h1>TI PORTO A BARCELLONA!</h1>
<h2>Un Capodanno insieme che ricorderemo per sempre</h2>
<canvas id="fireworks"></canvas>

<script>
/* ===== AUDIO CON FADE-IN ===== */
const audio = document.getElementById('audio');

window.addEventListener("load", () => {
  audio.volume = 0; // parte silenzioso
  audio.play().then(() => {
    // fade-in graduale fino al volume massimo
    let vol = 0;
    const fadeIn = setInterval(() => {
      if(vol < 1){
        vol += 0.05;
        audio.volume = Math.min(vol,1);
      } else {
        clearInterval(fadeIn);
      }
    }, 100);
  }).catch(() => {
    console.log("Autoplay bloccato, attendendo click dell'utente.");
    // fallback click
    document.body.addEventListener("click", () => {
      if(audio.paused){
        audio.play().then(() => { audio.volume = 1; });
      }
    }, { once: true });
  });
});

/* ===== FUOCHI D'ARTIFICIO ===== */
const canvas = document.getElementById('fireworks');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let fireworks = [];
let particles = [];

class Firework {
  constructor(x, y) {
    this.x = x;
    this.y = canvas.height;
    this.targetY = y;
    this.speed = 8;
    this.exploded = false;
  }
  update() {
    this.y -= this.speed;
    if(this.y <= this.targetY && !this.exploded) {
      this.explode();
      this.exploded = true;
    }
  }
  explode() {
    for(let i=0;i<50;i++){
      particles.push(new Particle(this.x, this.y));
    }
  }
  draw() {
    if(!this.exploded){
      ctx.beginPath();
      ctx.arc(this.x,this.y,3,0,Math.PI*2);
      ctx.fillStyle = 'white';
      ctx.fill();
    }
  }
}

class Particle {
  constructor(x,y){
    this.x = x;
    this.y = y;
    this.vx = Math.random()*6-3;
    this.vy = Math.random()*-5-2;
    this.alpha = 1;
    this.color = `hsl(${Math.random()*360},100%,50%)`;
  }
  update(){
    this.x += this.vx;
    this.y += this.vy;
    this.vy += 0.05;
    this.alpha -= 0.02;
  }
  draw(){
    ctx.globalAlpha = this.alpha;
    ctx.beginPath();
    ctx.arc(this.x,this.y,2,0,Math.PI*2);
    ctx.fillStyle = this.color;
    ctx.fill();
    ctx.globalAlpha = 1;
  }
}

function animate(){
  ctx.fillStyle = 'rgba(0,0,0,0.1)';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  if(Math.random()<0.05){
    const targetY = canvas.height * (0.1 + Math.random() * 0.3);
    fireworks.push(new Firework(Math.random()*canvas.width, targetY));
  }
  fireworks.forEach(f => { f.update(); f.draw(); });
  particles.forEach((p,i)=>{ 
    p.update(); 
    p.draw(); 
    if(p.alpha<=0) particles.splice(i,1); 
  });
  requestAnimationFrame(animate);
}

animate();

window.addEventListener('resize', ()=> {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});
</script>

</body>
</html>
